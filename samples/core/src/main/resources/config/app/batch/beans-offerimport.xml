<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:batch="http://www.springframework.org/schema/batch"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd">

  <batch:job id="offerImportJob" incrementer="incrementer">
    <batch:step id="offerImportStep">
      <batch:tasklet>
        <batch:chunk reader="offerReader" processor="offerProcessor" writer="offerWriter" commit-interval="2" skip-limit="1">
         <batch:skippable-exception-classes>
            <batch:include class="org.springframework.batch.item.file.FlatFileParseException"/>
            <batch:include class="org.springframework.batch.item.file.transform.IncorrectTokenCountException"/>
         </batch:skippable-exception-classes>
                <batch:listeners>
                    <batch:listener ref="skipListener" />
                </batch:listeners>
        </batch:chunk>
      </batch:tasklet>
    </batch:step>
  </batch:job>

  <bean id="offerReader" class="org.springframework.batch.item.file.FlatFileItemReader" scope="step">
    <property name="lineMapper">
      <bean class="org.springframework.batch.item.file.mapping.DefaultLineMapper">
        <property name="fieldSetMapper">
          <bean class="org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper">
            <property name="targetType" value="io.oasp.gastronomy.restaurant.offermanagement.batch.impl.offerimport.writer.OfferCsv"/>
          </bean>
        </property>
        <property name="lineTokenizer">
          <bean class="org.springframework.batch.item.file.transform.DelimitedLineTokenizer">
            <property name="names" value="name, description, state, meal_id, sidedish_id, drink_id, price" />
          </bean>
        </property>
      </bean>
    </property>
    <!-- Pass values to the configuration when launching a job. -->
    <property name="resource" value="#{jobParameters[pathToFile]}"/>
  </bean>

  <bean id="offerProcessor" class="io.oasp.gastronomy.restaurant.offermanagement.batch.impl.offerimport.writer.OfferItemConverter"/>

  <bean id="offerWriter" class="io.oasp.gastronomy.restaurant.offermanagement.batch.impl.offerimport.writer.OfferWriter"/>

  <bean id="skipListener" class="io.oasp.gastronomy.restaurant.batch.common.CustomSkipListener"/>
</beans>